Skip to main content
Stack Overflow на русском
Поиск...
Главная
Вопросы
Неотвеченные
Метки
Чат
Участники




Ошибка при хостинге бота на aiogram3 (pythonanywhere)
Вопрос задан 1 год 6 месяцев назад
Изменён 11 месяцев назад
Просмотрен 3k раза
1

Пытаюсь поставить телеграмм бота на aiogram3 на хостинг pythonanywhere. Но появляется ошибка при запуске: ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable].

Полная ошибка:

Traceback (most recent call last):
  File "/home/SmerchTT/.local/lib/python3.10/site-packages/aiohttp/connector.py", line 980, in _wrap_create_connection
    return await self._loop.create_connection(*args, **kwargs)  # type: ignore[return-value]  # noqa
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 1064, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 1049, in create_connection
    sock = await self._connect_sock(
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 960, in _connect_sock
    await self.sock_connect(sock, address)
  File "/usr/local/lib/python3.10/asyncio/selector_events.py", line 500, in sock_connect
    return await fut
  File "/usr/local/lib/python3.10/asyncio/selector_events.py", line 505, in _sock_connect
    sock.connect(address)
OSError: [Errno 101] Network is unreachable
The above exception was the direct cause of the following exception:
Traceback (most recent call last):
  File "/home/SmerchTT/.local/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 167, in make_request
    async with session.post(
  File "/home/SmerchTT/.local/lib/python3.10/site-packages/aiohttp/client.py", line 1167, in __aenter__
    self._resp = await self._coro
  File "/home/SmerchTT/.local/lib/python3.10/site-packages/aiohttp/client.py", line 562, in _request
    conn = await self._connector.connect(
  File "/home/SmerchTT/.local/lib/python3.10/site-packages/aiohttp/connector.py", line 540, in connect
    proto = await self._create_connection(req, traces, timeout)
  File "/home/SmerchTT/.local/lib/python3.10/site-packages/aiohttp/connector.py", line 901, in _create_connection
    _, proto = await self._create_direct_connection(req, traces, timeout)
  File "/home/SmerchTT/.local/lib/python3.10/site-packages/aiohttp/connector.py", line 1209, in _create_direct_connection
    raise last_exc
  File "/home/SmerchTT/.local/lib/python3.10/site-packages/aiohttp/connector.py", line 1178, in _create_direct_connection
    transp, proto = await self._wrap_create_connection(
  File "/home/SmerchTT/.local/lib/python3.10/site-packages/aiohttp/connector.py", line 988, in _wrap_create_connection
    raise client_error(req.connection_key, exc) from exc
aiohttp.client_exceptions.ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/SmerchTT/bot/main.py", line 170, in <module>
    asyncio.run(main())
  File "/usr/local/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/usr/local/lib/python3.10/asyncio/base_events.py", line 646, in run_until_complete
    return future.result()
  File "/home/SmerchTT/bot/main.py", line 166, in main
    await bot.delete_webhook(drop_pending_updates=True)
  File "/home/SmerchTT/.local/lib/python3.10/site-packages/aiogram/client/bot.py", line 1221, in delete_webhook
    return await self(call, request_timeout=request_timeout)
  File "/home/SmerchTT/.local/lib/python3.10/site-packages/aiogram/client/bot.py", line 432, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/SmerchTT/.local/lib/python3.10/site-packages/aiogram/client/session/base.py", line 257, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/SmerchTT/.local/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 174, in make_request
    raise TelegramNetworkError(method=method, message=f"{type(e).__name__}: {e}")
aiogram.exceptions.TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f09a18fffa0>
Я смотрел другие форумы, там говорилось что надо использовать другой прокси сервер, указав его в Bot():

bot = Bot(token='...', proxy='http://proxy.server:3128')
Но класс Bot() не имеет аргумента proxy, скорее всего из-за aiogram3

Скрин с VS Code

Bot.__init__() got an unexpected keyword argument 'proxy'
Также использовал библиотеку aiohttp-socks. Но ничего не вышло.

pythontelegram-botaiogramaiogram-3.x
Поделиться
Улучшить вопрос
Отслеживать
задан 3 нояб. 2023 в 3:19
QuL1ux's user avatar
QuL1ux
5633 серебряных знака2323 бронзовых знака
Добавить комментарий
1 ответ
Сортировка:

Наивысший рейтинг (по умолчанию)
1

Я смог решить свою проблему. Я оставлю тут этот пост, чтобы помочь тем кто столкнётся с этой проблемой.
Для начала нужно импортировать установить модуль aiohttp-socks в bash-консоли
pip install aiohttp-socks
Затем нужно импортировать модуль AiohttpSession
from aiogram.client.session.aiohttp import AiohttpSession
Теперь нужно создать переменную session
session = AiohttpSession(proxy='http://proxy.server:3128') # в proxy указан прокси сервер pythonanywhere, он нужен для подключения
В объекте бота указываем session=session
bot = Bot(token='...', session=session)
Мне это помогло, надеюсь поможет и другим.

Поделиться
Улучшить ответ
Отслеживать
ответ дан 3 нояб. 2023 в 3:35
QuL1ux's user avatar
QuL1ux
5633 серебряных знака2323 бронзовых знака
Спасибо, очень помогло, все по пунктам всделал и сразу заработало. Долго не мог понять почему бот не запускается. Пока не написал в техподдержку, там мне сказали, что бесплатные аккаунты не входят в allowedlist в целях безопасности от спамеров и хакеров. Поэтому нужно использовать proxy – 
Oleg Glazer
 Commented10 мая 2024 в 13:54
а можете подробнее объяснить, мне выдает from: can't read /var/mail/aiogram.client.session.aiohttp – 
Игорь
 Commented21 мая 2024 в 17:33
Добавить комментарий
Вопрос с повышенной активностью. Заработайте 10 баллов репутации (не считая бонус ассоциации), чтобы ответить на этот вопрос. Требование к репутации помогает защитить этот вопрос от спама и некачественных ответов.
Начните задавать вопросы и получать на них ответы

Найдите ответ на свой вопрос, задав его.

Изучите связанные вопросы

pythontelegram-botaiogramaiogram-3.x
Посмотрите похожие вопросы с этими метками.

Важное на Мете
Evolving comments: An experiment to encourage engagement and follow-up questions
Updates to advertising guidelines
Upcoming initiatives on Stack Overflow and across the Stack Exchange network...
Связанные
0
Ошибка при запуске кода на pythonanywhere
Похожие
0
Бот на pyrogram не запускается
1
Ошибка при попытке привязать Inline клавиатуру к сообщению Aiogram
0
telegram client на хостинг. Где ошибка?
1
Бот дискорд, который выдает роли по эмодзи, при запуске пишет ошибку
0
Как сделать автоматическое назначение текущего пользователя в качестве автора при создании поста?
0
Работает только стартовая команда бот телеграм
0
Проблема с токеном (discord bot)
 Лента вопроса







Stack Overflow на русском
Тур
Справка
Чат
Связаться с нами
Оставить отзыв
Компания
Stack Overflow
Teams
Advertising
Talent
О компании
Упоминания в СМИ
Соглашение
Политика конфиденциальности
Условия использования
Настройки файлов cookie
Политика о Cookie
Сеть Stack Exchange
Технологии
Культура и отдых
Жизнь и искусство
Наука
Специализация
Бизнес
API
Данные
Блог
Facebook
Твиттер
LinkedIn
Instagram
Site design / logo © 2025 Stack Exchange Inc; user contributions licensed under CC BY-SA . rev 2025.5.7.26191